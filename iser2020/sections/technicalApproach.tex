\section{Technical Approach}
\label{sec:TechnicalApproach}

As result of the impulse-momentum theorem, for a change of the momentum of the flywheels, an impulse, rooted in a force, is needed. 
The motors provide this force, and according to Newtons' third, a force is applied back, resulting in the opposite change of momentum of the sphere. 
So the rotation of the sphere is not a direct consequence of the angular momentum of the flywheels, but rather of the impulse needed to spin them. 
The well known Cubli \cite{cubliIROS12} also uses this phenomenon, utilizing the impulse generated by breaking spinning wheels, to generate a rotation of the whole system. The force does not come from the momentum due to rotation of the flywheels but through the impulse of the braking.
Unlike Cubli, a sphere does not loose energy to gravity compensation due to its form.
A sphere starts rolling by itself and only loses energy to friction.

\begin{wrapfigure}{l}{0.5\textwidth}
\centering                                                                                                                                                                                                        
\includegraphics[width=0.5\textwidth]{../Media/BlueprintPNG.png}                                                                                                                                                      
\caption{Blueprint of the mechanical structure of the spherical robot.}                                                                                                                                   
\label{sec:TechnicalApproach:fig:blueprint}                                                                                                                                                                       
\end{wrapfigure}                                                                                                                                                                                                      
Figure \ref{sec:TechnicalApproach:fig:blueprint} shows a CAD blueprint of the overall interior layout of the mechanical structure of the L.U.N.A sphere, ignoring the outside sphere, flywheels and wiring.
The the LMS-100-10000 laser scanner is mounted to the supporting structural components which are made of acrylic glass. It is an afforable laser scanner with high precision and a work-range of $\SI{0.5}{\meter}$ to $\SI{20}{\meter}$.
The Raspberry Pi 3B boardcomputer is placed on top of the laser. It was chosen because of its high availability and its USB and Ethernet port, as is simplifies the connection of the laser scanner (Ethernet) and the 3 IMUs (USB). This avoids further adapters or hubs in the already limited space. Furthermore, it has enough computing power for the required tasks.
Above the Pi, another supporting structure holds additional counterweights to correct for inhomogeneous weight distribution.                                                                                                     
The battery finds its place in front of the laser scanner on another supporting structure. It is an $\SI{1000}{\milli\ampere\hour}$, 30C and 3s lithium battery. 
It is a compromise of the acceptable run-time at operation of approximately 10 minutes and its dimensions. 
It powers the laser scanner and the ESCs directly, as well as an $\SI{12}{\volt}$ to $\SI{5}{\volt}$ step down converter for the Pi, mounted under the same plate as itself. 
Due to the experimental state, the connections use standard connection-clamps, instead of a power-board, which ensures high flexibility while building. 
The two brushless motors were each placed on one side of the supporting structure. The chosen Turnigy Park480 Brushless Outrunner $\SI{1320}{\kilo\volt}$ \cite{turnigymotor} provide high rotational speed but also the required height of the body (without shaft) of less than $\SI{34}{\milli\meter}$.
The motors are mounted with spacers, that leave room for the side IMU underneath one of the motors. 
The PhidgetsSpacial 10441B IMUs \cite{imuphidgets} are highly affordable IMUs with acceptable precision.
Two other IMUs are placed in front of and beneath the laser to ensure coverage of all axes. 
Finally a battery checker is mounted on the battery-holding plate, as a small battery combined with high power consumption would lead to deep discharge in a short period of time.

\begin{figure}
\centering
\includegraphics[height=55mm]{../Media/sphereFullshellLeft.jpg}
\hfill
\includegraphics[height=55mm]{../Media/sphereRightMotor.jpg}   
\caption{Hardware setup of the L.U.N.A sphere prototype, including notches in the shell and friction granule (left). IMU (beneath supporting structure) and brushless motor  including flywheel mass (above supporting structure) of the L.U.N.A sphere (right).}
\label{sec:TechnicalApproach:fig:setup}
\end{figure}

Figure \ref{sec:TechnicalApproach:fig:setup} shows the final hardware setup of the robot.
In order to reduce complexity with respect to the 3D-transformation calculations, the laser scanner was placed at the center of a spherical acrylic glass shell as precisely as possible.
This limits the laser scanners movement to rotational movement and removes translational movement completely. 
Strong epoxy glue attaches the weights to the motor shafts and shells.
As the flywheels start spinning with respect to the structural components of the sphere, the sphere itself starts spinning with respect to the ground. 

Figure \ref{sec:TechnicalApproach:fig:setup} also shows that the top and the bottom of the shell are covered in table salt, which made a good granule to increase friction to the ground in the early testing phase. 
Unfortunately, the laser scanner measurements are affected by blockades due to components of the sphere.
Specifically, the outside shell is an inhibiting factor as an object with the distance of the radius is measured at all times, which is why measurement slits  in the front side of the shell exist, to increase permeability for the laser.
                                                                                                                                                                                                                 
\subsection{Sensor Integration}
\label{sec:TechnicalApproach:sensorintegration}

The sensor integration is fully implemented with the Robot Operating System (ROS) using the Ubuntu distribution \href{http://wiki.ros.org/ROSberryPi}{ROSberryPi} which contains a pre-installed ROS version.
\begin{wrapfigure}{r}{5cm} 
\centering
\includegraphics[width=0.3\textwidth]{../Media/virtualIMU.png}                                                                                                                                                      
\caption{Illustration of the combination of 3 IMUs into 1 virtual IMU that simulates being at the center of the sphere.}                                                                                                                           
\label{sec:SensorIntegration:fig:virtual}                                                                                                                                                                       
\end{wrapfigure}                                                                                                                                                                                                      
Overall, three seperate IMUs keep track of the pose of the sphere. Each IMU is placed in such a way that the IMUs Z-axis corresponds to one possible rotation axis of the sphere.
Therefore, each IMU is perpendicular to the other two.
Combining the axes measurements leads to a "virtual" IMU, which emulates being an IMU positioned at the center of the sphere. 
Hence, isolating the measurements of the resulting virtual IMU to only the rotation in the given axis.
Figure \ref{sec:SensorIntegration:fig:virtual} illustrates this principal.
Previous prototypes have shown that transforming the data of only one non-centered IMU leads to lower quality measurements.
However, combining the measurements of three IMUs, where each measures only the static rotation around one of their rotational axes (which also represents a rotation axis of the sphere), leads to less noise, as seen in figures  \ref{sec:technicalApproach:fig:imu1_ang_vel}-\ref{sec:technicalApproach:fig:merged_ang_vel}.

\begin{figure}
\centering
\begin{subfigure}{0.45\textwidth}
\includegraphics[width=\textwidth]{./plotsAndScripts/angVel-2020-01-29-16-14-54/imu1_ang_vel}
\caption{IMU 1: Z-Axis corresponds to Sphere X-Axis}
\label{sec:technicalApproach:fig:imu1_ang_vel}
\end{subfigure}\hfill
\begin{subfigure}{0.45\textwidth}
\includegraphics[width=\textwidth]{./plotsAndScripts/angVel-2020-01-29-16-14-54/imu2_ang_vel}
\caption{IMU 2: Z-Axis corresponds to Sphere Z-Axis}
\label{sec:technicalApproach:fig:imu2_ang_vel}
\end{subfigure}\hfill\\

\begin{subfigure}{0.45\textwidth}
\includegraphics[width=\textwidth]{./plotsAndScripts/angVel-2020-01-29-16-14-54/imu3_ang_vel}
\caption{IMU 3: Z-Axis corresponds to Sphere Y-Axis}
\label{sec:technicalApproach:fig:imu3_ang_vel}
\end{subfigure}\hfill
\begin{subfigure}{0.45\textwidth}
\includegraphics[width=\textwidth]{./plotsAndScripts/angVel-2020-01-29-16-14-54/merged_ang_vel}
\caption{Merged virtual IMU. Maps the Z-Axis of all other IMUs to the rotational axes.}
\label{sec:technicalApproach:fig:merged_ang_vel}
\end{subfigure}\hfill
\caption{Angular velocity measurements of singular IMUs and the combined IMU.}
\label{sec:technicalApproach:fig:angvel}
\end{figure}

The IMUs also ship with accelerometers that are used to determine the full pose of the sphere.
Each IMU calculates their pose separately, using a quaternion extended Kalman filter (QEKF).
However, combining those poses into one does not have any positive effect, but only makes the software more resource demanding and slow.
Thus only the pose of the bottom IMU's accelerometer is used to keep track of the pose.

The motors are controlled using the piGPIO library. The GPIO signals are forwarded by the pins to two ESCs that drive the motors. 

Unfortunately, the brass weights are not drilled in the very center, causing an unbalance when rotating.
The resulting vibrations inhibit the movement of the sphere.
Thus a controller was implemented that measures the extend of the vibrations using standard deviations of the non-rotating axes of the IMU and adjusts the throttle of the motors accordingly.
This was done with a two-point controller with hysteresis.
Considering the translational velocity of the sphere in a controller is not possible.
The speed of the sphere is calculated by the rotational speed, which is why slippage of the sphere causes such a controller not to produce the desired motion. 

\subsection{Point Cloud Processing}                                                                                                                                                                                  
\label{sec:TechnicalApproach:pointcloudprocessing}
For the processing of the point cloud the 3D Toolkit (3DTK) was used.
This provides multiple methods and algorithms for processing 3D point clouds, especially the 6D continuous time Simultaneous Localization And Mapping (SLAM) algorithm (see \cite{3DARCH2017_1, LS2019}) as post-processing.
Therefore only the time-stamped raw data of the IMUs and laser scanner is transferred and the estimation of the pose and the SLAM algorithm itself is performed externally.
For this prototype the transfer is realized using the host-function of ROS, giving the external PC the possibility to subscribe to the topics and process them.
3DTK itself takes pairs of files, one representing the pose, one the laser scanner data, and each file named by the time-stamp with an identifier if it is scan-data or pose.
Also, the use of USB-connected IMUs and ROS as transfer-mechanism of data leaves potential for enhancement and therefore reducing the load of the internal controller.
